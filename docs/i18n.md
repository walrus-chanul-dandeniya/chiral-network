# Internationalization (i18n)

Chiral Network supports multiple languages through the svelte-i18n library.

## Supported Languages

Currently supported languages:
- **English (en)** - Default
- **Spanish (es)**
- **Russian (ru)**
- **Chinese (zh)**
- **Korean (ko)**
- **Portuguese (pt)**
- **Hindi (hi)**
- **French (fr)**
- **Bengali (bn)**
- **Arabic (ar)** - RTL (Right-to-Left) support

## Architecture

### Translation System

**Library**: svelte-i18n
**Location**: `src/i18n/i18n.ts`
**Locale Files**: `src/locales/*.json`

### File Structure

```
src/
├── i18n/
│   └── i18n.ts           # i18n setup and initialization
└── locales/
    ├── en.json           # English translations
    ├── es.json           # Spanish translations
    ├── ru.json           # Russian translations
    ├── zh.json           # Chinese translations
    └── ko.json           # Korean translations
```

## Using Translations

### In Svelte Components

```svelte
<script>
  import { t } from 'svelte-i18n';
</script>

<!-- Simple translation -->
<h1>{$t('nav.download')}</h1>

<!-- Translation with variables -->
<p>{$t('download.progress', { values: { percent: 75 } })}</p>

<!-- Pluralization -->
<span>{$t('files.count', { values: { n: fileCount } })}</span>
```

### Translation Key Structure

Keys use dot notation for organization:

```json
{
  "nav": {
    "download": "Download",
    "upload": "Upload",
    "network": "Network"
  },
  "download": {
    "title": "Downloads",
    "progress": "Progress: {percent}%",
    "searchPlaceholder": "Enter file hash..."
  }
}
```

## Language Detection

### Automatic Detection

On first launch, the application:

1. **Checks localStorage** for saved preference
2. **If no preference**, detects based on:
   - User's geographic location (via geolocation service)
   - Browser language settings
   - Falls back to English
3. **Saves preference** to localStorage

### Manual Language Selection

Users can change language in Settings:

1. Navigate to **Settings** → **General**
2. Find **Language** dropdown
3. Select preferred language
4. Application reloads with new language

## Adding Translations

### For New Features

When adding new UI text:

1. **Add keys to ALL locale files** (`en.json`, `es.json`, `ru.json`, `zh.json`, `ko.json`)
2. **Use descriptive key paths**
3. **Keep translations consistent**
4. **Test with all languages**

### Example: Adding a New Page

```json
// en.json
{
  "myNewPage": {
    "title": "My New Page",
    "subtitle": "This is a new feature",
    "button": {
      "save": "Save",
      "cancel": "Cancel"
    }
  }
}

// es.json
{
  "myNewPage": {
    "title": "Mi Nueva Página",
    "subtitle": "Esta es una nueva función",
    "button": {
      "save": "Guardar",
      "cancel": "Cancelar"
    }
  }
}

// ... repeat for ru.json, zh.json, ko.json
```

## Translation Guidelines

### Key Naming Conventions

- Use **camelCase** for key names
- Group related keys together
- Use **descriptive names**, not generic ones

**Good**:
```json
{
  "download": {
    "searchPlaceholder": "Enter file hash...",
    "noResults": "No files found"
  }
}
```

**Bad**:
```json
{
  "text1": "Enter file hash...",
  "message": "No files found"
}
```

### Writing Good Translations

1. **Keep it concise** - UI space is limited
2. **Be consistent** - Use same terms throughout
3. **Consider context** - Same word may need different translations in different contexts
4. **Use placeholders** - For dynamic content: `{variableName}`
5. **Test truncation** - Some languages are longer than English

### Pluralization

Use svelte-i18n pluralization features:

```json
{
  "files": {
    "count": "{n} file | {n} files"
  }
}
```

Usage:
```svelte
{$t('files.count', { values: { n: fileCount } })}
```

## Contributing Translations

### Adding a New Language

1. **Create new locale file**: `src/locales/[lang-code].json`
2. **Copy structure from** `en.json`
3. **Translate all keys**
4. **Update i18n.ts** to include new language
5. **Add language option** to Settings page
6. **Test thoroughly**

### Improving Existing Translations

1. **Find the locale file**: `src/locales/[lang].json`
2. **Update translations**
3. **Ensure consistency** with other keys
4. **Test in application**
5. **Submit pull request**

### Translation Checklist

Before submitting translations:

- [ ] All keys translated (no English fallbacks)
- [ ] Translations are accurate and natural
- [ ] Tested in application UI
- [ ] No truncation issues
- [ ] Pluralization works correctly
- [ ] Variables render properly
- [ ] Special characters display correctly
- [ ] Consistent terminology throughout

## Current Translation Coverage

### Fully Translated

All major UI components:
- Navigation menu
- Page titles and subtitles
- Button labels
- Form fields
- Error messages
- Success notifications

### Partially Translated

Some areas may still show English:
- Developer tools (intentional)
- Technical error messages
- Debug console output

### Not Translated

Intentionally English-only:
- Code comments
- API responses
- Log messages
- File paths

## Testing Translations

### Manual Testing

1. **Change language** in Settings
2. **Navigate through all pages**
3. **Check for**:
   - Missing translations (English fallbacks)
   - Truncated text
   - Layout breaks
   - Placeholder rendering issues
4. **Test dynamic content** (notifications, errors)

### Automated Testing

Add tests for new translation keys:

```typescript
import { get } from 'svelte/store';
import { locale, t } from 'svelte-i18n';

// Test all languages have the key
['en', 'es', 'ru', 'zh', 'ko'].forEach(lang => {
  locale.set(lang);
  const translation = get(t)('myNewPage.title');
  expect(translation).not.toContain('myNewPage.title'); // Not using fallback
});
```

## Common Issues

### Text Not Translating

**Causes**:
- Missing key in locale file
- Typo in key name
- i18n not initialized
- Language not loaded

**Solutions**:
- Check key exists in all locale files
- Verify key path is correct
- Check browser console for errors
- Restart application

### Wrong Language Displayed

**Causes**:
- Cached preference in localStorage
- Geolocation detected wrong region
- Browser language mismatch

**Solutions**:
- Clear localStorage and restart
- Manually select language in Settings
- Check browser language settings

### Special Characters Not Displaying

**Causes**:
- Incorrect character encoding
- Font doesn't support characters
- JSON parsing issues

**Solutions**:
- Ensure UTF-8 encoding
- Use Unicode escape sequences
- Check JSON syntax

## API Reference

### Setup Function

```typescript
// src/i18n/i18n.ts
export async function setupI18n(): Promise<void> {
  // Initialize i18n with default locale
  // Register locale files
  // Set initial locale
}
```

### Usage in Components

```typescript
import { t, locale } from 'svelte-i18n';

// Get current locale
const currentLocale = $locale; // e.g., 'en'

// Set locale
locale.set('es');

// Translate key
const translated = $t('nav.download'); // 'Download' or 'Descargar'

// Translate with variables
const msg = $t('download.progress', { values: { percent: 50 } });
// 'Progress: 50%'
```

## Resources

### svelte-i18n Documentation
- [Official Docs](https://github.com/kaisermann/svelte-i18n)
- [API Reference](https://github.com/kaisermann/svelte-i18n/blob/main/docs/API.md)

### Translation Tools
- [Google Translate](https://translate.google.com/) - Quick translations
- [DeepL](https://www.deepl.com/) - High-quality translations
- [Crowdin](https://crowdin.com/) - Collaborative translation platform

### Language Resources
- ISO 639-1 Language Codes
- Unicode Character Database
- CLDR Locale Data

## See Also

- [Implementation Guide](implementation-guide.md) - Development workflow
- [Contributing Guide](contributing.md) - How to contribute
- [User Guide](user-guide.md) - Using language settings
